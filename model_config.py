import numpy as np


RADAR_PRECISION = 0.05

THRESHOLDS_POS = np.array(
    [
        500,
        450,
        400,
        350,
        300,
        250,
        200,
        150,
        125,
        100,
        75,
        50,
        35,
        25,
        15,
        10,
        7,
        5,
        2,
        1,
        0.6,
        0.4,
        0.2,
        0.1,
        0.05,
        0.01,
    ]
)
THRESHOLDS_MM = np.sort(THRESHOLDS_POS)


TARGET_THRESHOLDS = np.array([0.1, 0.2, 0.4, 1, 10, 50, 100])

GBDT_PARAMS_AIFS = {
    0.1: {
        "num_tree": 434,
        "learning_rate": 0.008610741,
        "num_leaves": 9,
        "lambda_l1": 4.267139881,
        "lambda_l2": 97.2638366,
        "min_data_in_leaves": 48,
        "subsample": 0.8,
        "bagging_freq": 1,
        "objective": "regression",
        "verbose": -1,
        "num_threads": 48,
        "seed": 0,
    },
    0.2: {
        "num_tree": 104,
        "learning_rate": 0.036846034,
        "num_leaves": 9,
        "lambda_l1": 49.08361487,
        "lambda_l2": 79.82671711,
        "min_data_in_leaves": 61,
        "subsample": 0.8,
        "bagging_freq": 1,
        "objective": "regression",
        "verbose": -1,
        "num_threads": 48,
        "seed": 0,
    },
    0.4: {
        "num_tree": 237,
        "learning_rate": 0.015205419,
        "num_leaves": 11,
        "lambda_l1": 7.1730353,
        "lambda_l2": 3.419355676,
        "min_data_in_leaves": 50,
        "subsample": 0.8,
        "bagging_freq": 1,
        "objective": "regression",
        "verbose": -1,
        "num_threads": 48,
        "seed": 0,
    },
    1: {
        "num_tree": 385,
        "learning_rate": 0.009170123,
        "num_leaves": 11,
        "lambda_l1": 21.41599917,
        "lambda_l2": 51.75260957,
        "min_data_in_leaves": 51,
        "subsample": 0.8,
        "bagging_freq": 1,
        "objective": "regression",
        "verbose": -1,
        "num_threads": 48,
        "seed": 0,
    },
    10: {
        "num_tree": 122,
        "learning_rate": 0.053802512,
        "num_leaves": 4,
        "lambda_l1": 20.85741416,
        "lambda_l2": 94.03557056,
        "min_data_in_leaves": 187,
        "subsample": 0.8,
        "bagging_freq": 1,
        "objective": "regression",
        "verbose": -1,
        "num_threads": 48,
        "seed": 0,
    },
    50: {
        "num_tree": 474,
        "learning_rate": 0.017813116,
        "num_leaves": 3,
        "lambda_l1": 2.883442952,
        "lambda_l2": 5.784621427,
        "min_data_in_leaves": 182,
        "subsample": 0.8,
        "bagging_freq": 1,
        "objective": "regression",
        "verbose": -1,
        "num_threads": 48,
        "seed": 0,
    },
    100: {
        "num_tree": 259,
        "learning_rate": 0.022789649,
        "num_leaves": 7,
        "lambda_l1": 6.822430045,
        "lambda_l2": 25.31642317,
        "min_data_in_leaves": 81,
        "subsample": 0.8,
        "bagging_freq": 1,
        "objective": "regression",
        "verbose": -1,
        "num_threads": 48,
        "seed": 0,
    },
}

GBDT_PARAMS_HRES = {
    0.1: {
        "num_tree": 271,
        "learning_rate": 0.018393406,
        "num_leaves": 24,
        "lambda_l1": 48.61455099,
        "lambda_l2": 97.15934044,
        "min_data_in_leaves": 173,
        "subsample": 0.8,
        "bagging_freq": 1,
        "objective": "regression",
        "verbose": -1,
        "num_threads": 48,
        "seed": 0,
    },
    0.2: {
        "num_tree": 203,
        "learning_rate": 0.025723981,
        "num_leaves": 24,
        "lambda_l1": 51.54437739,
        "lambda_l2": 59.58986471,
        "min_data_in_leaves": 185,
        "subsample": 0.8,
        "bagging_freq": 1,
        "objective": "regression",
        "verbose": -1,
        "num_threads": 48,
        "seed": 0,
    },
    0.4: {
        "num_tree": 165,
        "learning_rate": 0.02628433,
        "num_leaves": 36,
        "lambda_l1": 47.78928766,
        "lambda_l2": 97.17255054,
        "min_data_in_leaves": 43,
        "subsample": 0.8,
        "bagging_freq": 1,
        "objective": "regression",
        "verbose": -1,
        "num_threads": 48,
        "seed": 0,
    },
    1: {
        "num_tree": 299,
        "learning_rate": 0.01585765,
        "num_leaves": 24,
        "lambda_l1": 53.03381826,
        "lambda_l2": 91.5223063,
        "min_data_in_leaves": 31,
        "subsample": 0.8,
        "bagging_freq": 1,
        "objective": "regression",
        "verbose": -1,
        "num_threads": 48,
        "seed": 0,
    },
    10: {
        "num_tree": 255,
        "learning_rate": 0.018613433,
        "num_leaves": 16,
        "lambda_l1": 36.40439857,
        "lambda_l2": 64.62636435,
        "min_data_in_leaves": 40,
        "subsample": 0.8,
        "bagging_freq": 1,
        "objective": "regression",
        "verbose": -1,
        "num_threads": 48,
        "seed": 0,
    },
    50: {
        "num_tree": 118,
        "learning_rate": 0.040337989,
        "num_leaves": 34,
        "lambda_l1": 90.36293265,
        "lambda_l2": 91.80133913,
        "min_data_in_leaves": 161,
        "subsample": 0.8,
        "bagging_freq": 1,
        "objective": "regression",
        "verbose": -1,
        "num_threads": 48,
        "seed": 0,
    },
    100: {
        "num_tree": 278,
        "learning_rate": 0.0123954,
        "num_leaves": 6,
        "lambda_l1": 0.365660959,
        "lambda_l2": 5.68628589,
        "min_data_in_leaves": 32,
        "subsample": 0.8,
        "bagging_freq": 1,
        "objective": "regression",
        "verbose": -1,
        "num_threads": 48,
        "seed": 0,
    },
}


GBDT_PARAMS_ALL = {
    "AIFS": {
        "all": {
            "num_tree": 181,
            "learning_rate": 0.011423821,
            "num_leaves": 16,
            "lambda_l1": 7.988352952,
            "lambda_l2": 0.996616109,
            "min_data_in_leaves": 72,
            "subsample": 0.8,
            "bagging_freq": 1,
            "objective": "regression",
            "verbose": -1,
            "num_threads": 48,
            "seed": 0,
        }
    },
    "HRES": {
        "all": {
            "num_tree": 339,
            "learning_rate": 0.006063168,
            "num_leaves": 25,
            "lambda_l1": 7.266503554,
            "lambda_l2": 63.74817512,
            "min_data_in_leaves": 120,
            "subsample": 0.8,
            "bagging_freq": 1,
            "objective": "regression",
            "verbose": -1,
            "num_threads": 48,
            "seed": 0,
        }
    },
}


# Used to generate the bin boundaries used by LightGBM
# to bin data for the precipitaiton variables.
FORCED_BINS_IN_M = [
    0.0001,
    0.0002,
    0.0003,
    0.0004,
    0.0005,
    0.0006,
    0.0007,
    0.0008,
    0.0009,
    0.001,
    0.0011,
    0.0012,
    0.0013,
    0.0014,
    0.0015,
    0.0016,
    0.0017,
    0.0018,
    0.0019,
    0.002,
    0.0021,
    0.0022,
    0.0023,
    0.0024,
    0.0025,
    0.0026,
    0.0027,
    0.0028,
    0.0029,
    0.003,
    0.0031,
    0.0032,
    0.0033,
    0.0034,
    0.0035,
    0.0036,
    0.0037,
    0.0038,
    0.0039,
    0.004,
    0.0041,
    0.0042,
    0.0043,
    0.0044,
    0.0045,
    0.0046,
    0.0047,
    0.0048,
    0.0049,
    0.005,
    0.0052,
    0.0054,
    0.0056,
    0.0058,
    0.006,
    0.0062,
    0.0064,
    0.0066,
    0.0068,
    0.007,
    0.0072,
    0.0074,
    0.0076,
    0.0078,
    0.008,
    0.0082,
    0.0084,
    0.0086,
    0.0088,
    0.009,
    0.0092,
    0.0094,
    0.0096,
    0.0098,
    0.01,
    0.0105,
    0.011,
    0.0115,
    0.012,
    0.0125,
    0.013,
    0.0135,
    0.014,
    0.0145,
    0.015,
    0.0155,
    0.016,
    0.0165,
    0.017,
    0.0175,
    0.018,
    0.0185,
    0.019,
    0.0195,
    0.02,
    0.021,
    0.022,
    0.023,
    0.024,
    0.025,
    0.026,
    0.027,
    0.028,
    0.029,
    0.03,
    0.031,
    0.032,
    0.033,
    0.034,
    0.035,
    0.036,
    0.037,
    0.038,
    0.039,
    0.04,
    0.041,
    0.042,
    0.043,
    0.044,
    0.045,
    0.046,
    0.047,
    0.048,
    0.049,
    0.05,
    0.055,
    0.06,
    0.065,
    0.07,
    0.075,
    0.08,
    0.085,
    0.09,
    0.095,
    0.1,
    0.11,
    0.12,
    0.13,
    0.14,
    0.15,
    0.2,
    0.25,
    0.3,
    0.35,
    0.4,
    0.45,
]

# The following values are passed to choose_set_of_percentiles which generates
# a set of evenly spaced percentiles.
DEFAULT_ERROR_PERCENTILES_COUNT = 19  # Maps to 5, 10, ..., 90, 95
DEFAULT_REALIZATIONS_COUNT = 199  # Maps to 0.5, 1.0, 1.5, ..., 99.0, 99.5

TRAINING_DATA_FILE_FORMAT = (
    "{model}-training-{month}-PT{accum_period_hours:02d}H.parquet"
)

GBDT_FILE_FORMAT_IN_MM = "lgb_model-{model}-lead_time_{lead_time:03d}H-threshold_{threshold:04.2f}-PT{accum_period_hours:02d}H.txt"  # noqa: E501


GBDT_FILE_FORMAT_IN_M = "lgb_model-{model}-lead_time_{lead_time:03d}H-threshold_{threshold:08.6f}-PT{accum_period_hours:02d}H.txt"  # noqa: E501

COMPILED_GBDT_FILE_FORMAT_IN_MM = (
    "lgb_model-{model}-threshold_{threshold:04.2f}-PT{accum_period_hours:02d}H.so"
)

COMPILED_GBDT_FILE_FORMAT_IN_M = (
    "lgb_model-{model}-threshold_{threshold:08.6f}-PT{accum_period_hours:02d}H.so"
)

MODEL_CONFIG_FILE_FORMAT = "model_config-{model}-PT{accum_period_hours:02d}H.json"

GBDT_UPDATED_PARAMETERS = {
    "AIFS": {
        "num_tree": 100,
        "learning_rate": 0.025,
        "num_leaves": 8,
        "subsample": 0.8,
        "bagging_freq": 1,
        "objective": "regression",
        "verbose": -1,
        "num_threads": 48,
        "bin_construct_sample_cnt": int(1e9),
        "seed": 0,
    },
    "HRES": {
        "num_tree": 100,
        "learning_rate": 0.025,
        "num_leaves": 25,
        "subsample": 0.8,
        "bagging_freq": 1,
        "objective": "regression",
        "lambda_l1": 12,
        "verbose": -1,
        "num_threads": 48,
        "bin_construct_sample_cnt": int(1e9),
        "seed": 0,
    },
}


GBDT_PARAMETERS = {
    "default": {
        "num_tree": 400,
        "learning_rate": 0.025,
        "num_leaves": 5,
        "subsample": 0.8,
        "bagging_freq": 1,
        "objective": "regression",
        "verbose": -1,
        "num_threads": 48,
        "bin_construct_sample_cnt": int(1e9),
        "seed": 0,
    },
    "high_thresholds": {
        "num_tree": 400,
        "learning_rate": 0.025,
        "num_leaves": 2,
        "min_data_in_leaf": 100,
        "lambda_l1": 50,
        "lambda_l2": 50,
        "min_sum_hessian_in_leaf": 200,
        "max_bin": 20,
        "subsample": 0.8,
        "objective": "binary",
        "verbose": -1,
        "bagging_freq": 1,
        "num_threads": 5,
    },
    "test": {
        "num_tree": 2,
        "learning_rate": 0.01,
        "num_leaves": 25,
        "min_data_in_leaf": 100,
        "min_sum_hessian_in_leaf": 0.1,
        "subsample": 0.8,
        "bagging_freq": 1,
        "objective": "binary",
        "verbose": -1,
    },
}
